# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with the AliDonerBot codebase.

## Project Overview

**AliDonerBot** is an AI monitoring agent (bot de veille IA) that:
- Collects AI news from free sources (RSS, Hacker News, Reddit, GitHub)
- Analyzes and prioritizes items (P0/P1/P2/P3)
- Generates Telegram-formatted digests
- **Sends directly on Telegram** via BotFather token
- **No paid APIs required** - uses public RSS, scraping, free APIs
- Covers both "monde/market" (funding, acquisitions, regulation) and "builders/indie dev" (trending repos, new tools, Show HN)

## Commands

```bash
# Setup Telegram (interactive)
cd "/home/user/future/perso projects/bot veille"
python setup_telegram.py

# Run the bot (save file only)
python bot.py

# Run and SEND on Telegram
python bot.py --send

# Last 24h, send on Telegram
python bot.py --days 1 --send

# Since last run, send on Telegram
python bot.py --since-last-run --send

# Schedule daily at 8am (stays running)
python bot.py --schedule 08:00

# Custom output file
python bot.py --output today.txt

# Install dependencies
pip install -r requirements.txt
```

## Architecture

### Data Flow
1. **Collection** (`sources/`):
   - `rss_fetcher.py` - RSS feeds from 30+ blogs (labs, media, opensource, research)
   - `hackernews.py` - HN via Algolia API (free, 12 queries including "Show HN AI", "AI tool")
   - `reddit.py` - Reddit JSON endpoints (7 subreddits including r/selfhosted, r/StableDiffusion)
   - `github_trending.py` - GitHub trending scraping (10 topics including langchain, ollama, rag)

2. **Analysis** (`analyzer.py`):
   - Priority detection (keywords: P0 > P1 > P2 > P3)
   - Category classification (Model/Product/Infra/Security/Business)
   - Deduplication (by topic keywords)
   - Scoring (priority + source boost + recency + engagement)

3. **Formatting** (`telegram_formatter.py`):
   - Top items (P0/P1, max 7)
   - Radar items (P2, max 4)
   - Rumeurs (community-sourced, low confidence)
   - Actions suggestions (max 3)
   - Telegram-compatible output with AliDonerBot branding

4. **Sending** (`telegram_sender.py`):
   - Sends via python-telegram-bot
   - Auto-splits long messages (>4096 chars)
   - Graceful fallback if no token configured

### Key Files
- `bot.py` - `AliDonerBot` class, CLI entry point with --send, --since-last-run, --schedule
- `config.py` - Sources, filtering, Telegram config, last_run tracking
- `analyzer.py` - `NewsAnalyzer` class with prioritization logic
- `telegram_formatter.py` - `TelegramFormatter` class for output
- `telegram_sender.py` - `TelegramSender` class for actual Telegram delivery
- `setup_telegram.py` - Interactive setup for BotFather token + chat_id
- `.env` - Secrets (TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID)
- `.last_run` - Timestamp of last successful run
- `SUIVI.md` - Full development log

## Configuration (`config.py`)

### Telegram:
Set via `.env` file (generated by `setup_telegram.py`):
```
TELEGRAM_BOT_TOKEN=123456:ABCdef...
TELEGRAM_CHAT_ID=123456789
```

### Adding a new RSS source:
```python
Source("Name", "https://url/feed.xml", "rss", "category", priority_boost=0)
```

### Categories
- `labs` - AI labs (OpenAI, Anthropic, Google, Meta, Mistral, xAI, etc.)
- `media` - Tech media (TechCrunch, Verge, VentureBeat, etc.)
- `india` - Indian tech scene
- `opensource` - OSS projects (HuggingFace, LangChain, Ollama, etc.)
- `community` - Reddit, HN, etc.
- `research` - Papers, MIT, BAIR

### Priority Keywords
- `P0`: "announces", "released", "launch", "vulnerability", "funding", "acquisition", "regulation", "ban", "outage", etc.
- `P1`: "new model", "update", "API", "benchmark", "open source", "Show HN", "self-hosted", "trending", etc.
- `P2`: "tool", "feature", "tutorial", "guide", "RAG", "agent", "quantization", etc.

## Output Format

```
ðŸ¥™ AliDonerBot | DD MMM YYYY | derniÃ¨res 24h

ðŸ”¥ TOP (Ã€ lire absolument)

1. [P0] Title here
   â†’ Summary
   ðŸ’¡ Why it matters
   ðŸ”— URL

ðŸ“¡ Sur le radar

â€¢ [Category] Title
  ðŸ”— URL

ðŸ‘€ Rumeurs / Non confirmÃ©

â€¢ Rumor title
  ðŸ”— URL

âš¡ Actions suggÃ©rÃ©es
â€¢ Action 1
â€¢ Action 2

â€”
ðŸ“Š X items | Sources: RSS, HN, Reddit, GitHub
```

## Development Notes

### Adding a new source type:
1. Create new file in `sources/`
2. Implement fetch method returning list of dicts with keys:
   - `source`, `title`, `link`, `summary`, `published`, `type`
   - Optional: `score` for engagement metrics, `priority_boost`
3. Add to `bot.py` in the collection phase
4. Update `CLAUDE.md` with new command if needed

### Modifying priority rules:
Edit `config.PRIORITY_KEYWORDS` - the analyzer counts matches in title+summary.

## Important Rules

1. **No paid APIs** - Only free sources (RSS, public JSON endpoints, scraping)
2. **Rate limiting** - All fetchers sleep between requests (0.3-0.5s)
3. **No duplicates** - Analyzer deduplicates by topic keywords
4. **French output** - Telegram messages must be in French
5. **Max ~10 items** - Keep digest concise and readable (< 2 minutes)
6. **Telegram secrets in .env** - Never hardcode tokens
7. **Bot name** - AliDonerBot everywhere

## Testing

```bash
# Test individual fetchers
python -c "from sources.rss_fetcher import RSSFetcher; f=RSSFetcher(); print(f.fetch_feed('Test', 'https://openai.com/blog/rss.xml'))"

# Test Telegram connection
python -c "from telegram_sender import get_sender_from_env; s=get_sender_from_env(); import asyncio; asyncio.run(s.test_connection())"

# Test full pipeline without sending
python bot.py --days 1

# Test with sending
python bot.py --days 1 --send
```
